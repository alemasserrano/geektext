<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <title>
    <%=title%>
  </title>
  <meta name="generator" content="Bootply" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
  <!--[if lt IE 9]>
			<script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
  <link href="css/styles.css" rel="stylesheet">
</head>
<body>
  <header class="navbar navbar-bright navbar-fixed-top" role="banner">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a href="/" class="navbar-brand">Home</a>
      </div>
      <nav class="collapse navbar-collapse" role="navigation">
        <ul class="nav navbar-nav">
          <%for(let i = 0; i < nav.length; i++) {%>
          <li>
            <a href="<%=nav[i].link%>">
              <%=nav[i].title%></a>
          </li>
          <%}%>
        </ul>
        <ul class="nav navbar-right navbar-nav">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="glyphicon glyphicon-search"></i></a>
            <ul class="dropdown-menu" style="padding:12px;">
              <form class="form-inline">
                <button type="submit" class="btn btn-default pull-right"><i class="glyphicon glyphicon-search"></i></button><input
                  type="text" class="form-control pull-left" placeholder="Search">
              </form>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </header>

  <div id="masthead">
    <div class="container">
      <div class="row">
        <div class="col-md-7">
          <h1>
            <%=title%>
            <p class="lead"></p>
          </h1>
        </div>
        <div class="col-md-5">
          <div class="well well-lg">
            <div class="row">
              <div class="col-sm-12">


              </div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /cont -->

    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <div class="top-spacer"> </div>
        </div>
      </div>
    </div><!-- /cont -->

  </div>
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".navbar-collapse">
      </button>

        <header> Sort By</header>
        <select id="booksSortDropdown">
          <option value=""></option>
          <option value="book_title">Book Title</option>
          <option value="author_name_first">Author Name</option>
          <option value="book_price">Book Price</option>
          <option value="release_date">Book Release Date</option>
        </select>

        <header> Page by</header>
        <select id="limit">
          <option value=""></option>
          <option value="10">10</option>
          <option value="20">20</option>
        </select>

        <header>Browse By Genre</header>
        <select id="browseByGenre">
          <option value=""></option>
          <option value="fantasy">Fantasy</option>
          <option value="romance">Romance</option>
          <option value="thriller">Thriller</option>
          <option value="science_fiction">Science Fiction</option>
          <option value="biography">Biography</option>
          <option value="political">Political</option>
          <option value="science_and_technology">Science and Technology</option>
          <option value="novel">Novel</option>
          <option value="historical_fiction">Historical Fiction</option>
        </select>

        <header>Browse by Top Seller</header>
        <select id="browseByTopSeller">
          <option value=""></option>
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select>

        <header>Browse by Book Rating</header>
        <select id="browseByBookRating">
          <option value=""></option>
          <option value="ascBookRating">Ascending</option>
          <option value="descBookRating">Descending</option>
        </select>

        <br><br>
        <button id="previousPage">Previous Page</button>
        <button id="nextPage">Next Page</button>
        <br><br>

        <!-- <header>Browse by Rating</header>
        <select id="browseByRating">
          <option value=""></option>
          <option value="false">No</option>
          <option value="true">Yes</option>
        </select> -->
    </div>

  </div>

  <div class="container">
    <div class="row">

      <div class="col-md-12">

        <div class="panel">
          <div class="panel-body">



            <!--/stories-->
            <%for(let i = 0; i < books.length; i++) {%>
            <div class="row">
                <div class="col-sm-6 col-md-4">
                    <div class="thumbnail">
                        <img src= '<%=books[i].img%>' alt="..." class="img-responsive">
                        <div class="caption">
                            <h3> <%=books[i].title%> </h3>
                            <h3>  <%=books[i].author_name%> </h3>
                            <p> <%=books[i].genre%></p>
                            <p>Book Rating: <%=books[i].ratingNumber%> </p>
                            <div class="read pull-right btn btn-success">
                                <a href="/books/<%=books[i].id%>"> Read More</a></small>
                              </div>
                            <div class="clearfix">
                                <div class="price pull-left"> <%=books[i].price%> </div>
                                <a href="#" class="btn btn-success pull-right" role="button">Add to Cart</a>
                            </div>
                        </div>
                    </div>
                  </div>
              </div>
            <%}%>
            <!--/stories-->
            <a href="/" class="btn btn-primary pull-right btnNext">More <i class="glyphicon glyphicon-chevron-right"></i></a>

          </div>
        </div>



      </div>
      <!--/col-12-->
    </div>
  </div>


  <hr>

  <div class="container" id="footer">
    <div class="row">
      <div class="col col-sm-12">

      </div>
    </div>
  </div>

  <hr>

  <hr>

  <footer>
    <div class="container">
      <div class="row">
        <div class="col-sm-6">


        </div>

      </div>
    </div>
  </footer>
  <!-- script references -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script type="text/javascript">
    var booksSortDropdown = document.getElementById("booksSortDropdown");
    var browseByGenre = document.getElementById("browseByGenre");
    var browseByTopSeller = document.getElementById("browseByTopSeller");
    var limit = document.getElementById("limit");
    var browseByBookRating = document.getElementById("browseByBookRating");
    var nextPage = document.getElementById("nextPage");
    var previousPage = document.getElementById("previousPage");
    const searchParams = new URL(window.location.href).searchParams;
    var state = {
      "sort_by": searchParams.get("sort_by") || null,
      "direction": searchParams.get("direction") || null,
      "browse": searchParams.get("browse") || null,
      "limit": Number(searchParams.get("limit") || 100),
      "page": Number(searchParams.get("page") || 0)
    };
    if (state["sort_by"]) {
      booksSortDropdown.value = state["sort_by"];
    }
    if (state["limit"]){
      limit.value = state["limit"];
    }
    if (state["browse"]) {
      if (state["browse"] == "true" || state["browse"] == "false") {
        browseByTopSeller.value = state["browse"];
      }
      if(state["browse"] == "descBookRating" || state["browse"] == "ascBookRating"){
        browseByBookRating.value = state["browse"];
      }
      else {
        browseByGenre.value = state["browse"];
      }
    }
    function fireRedirect() {
      let urlToRedirect = "/books";
      const urlParameters = [];
      if (state["sort_by"]) {
        urlParameters.push(`sort_by=${state["sort_by"]}`);
      }
      if (state["direction"]) {
        urlParameters.push(`direction=${state["direction"]}`);
      }
      if (state["browse"]) {
        urlParameters.push(`browse=${state["browse"]}`);
      }
      if (state["limit"]) {
        urlParameters.push(`limit=${state["limit"]}`);
      }
      if (state["page"]) {
        urlParameters.push(`page=${state["page"]}`);
      }
      if (urlParameters.length > 0) {
        urlToRedirect += "?";
        urlToRedirect += urlParameters.join("&");
      }
      window.location.assign(urlToRedirect);
    }
    browseByGenre.addEventListener("change", function() {
      state["browse"] = browseByGenre.value || null;
      state["page"] = 0;
      fireRedirect();
    });
    limit.addEventListener("change", function() {
      state["limit"] = limit.value || 100;
      state["page"] = 0;
      fireRedirect();
    });
    booksSortDropdown.addEventListener("change", function() {
      state["sort_by"] = booksSortDropdown.value || null;
      state["direction"] = "asc";
      state["page"] = 0;
      fireRedirect();
    });
    browseByTopSeller.addEventListener("change", function() {
      state["browse"] = browseByTopSeller.value || null;
      state["page"] = 0;
      fireRedirect();
    });
    browseByBookRating.addEventListener("change", function() {
      state["browse"] = browseByBookRating.value || null;
      state["page"] = 0;
      fireRedirect();
    });
    nextPage.addEventListener("mouseup", function() {
      state["page"] = state["page"] + 1;
      fireRedirect();
    });
    previousPage.addEventListener("mouseup", function() {
      if (state["page"] <= 0) {
        return;
      }
      state["page"] = state["page"] - 1;
      fireRedirect();
    });
  </script>

</body>

</html>
